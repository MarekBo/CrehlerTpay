(window.webpackJsonp=window.webpackJsonp||[]).push([["tpay-shopware-payment"],{W1qi:function(t,e,n){"use strict";n.r(e);var i=n("FGIj"),o=n("ERap"),r=n("gHbT");function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function c(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d,p,f,y=function(t){function e(){return s(this,e),c(this,u(e).apply(this,arguments))}var n,i,a;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this._form=r.a.querySelector(document,this.options.formSelector),this.formAutoSubmitInstance=PluginManager.getPluginInstanceFromElement(this._form,"FormAutoSubmit"),this.formAutoSubmitInstance.options.changeTriggerSelectors.push(this.options.changeTriggerSelector),this._banks=r.a.querySelectorAll(this.el,this.options.bankLabelSelector),this._paymentInputPaymentInput=r.a.querySelector(document,'[name="'.concat(this.options.paymentMethodInputName,'"][value="').concat(this.options.paymentId,'"]')),this._registerEvents()}},{key:"_registerEvents",value:function(){var t=this;o.a.iterate(this._banks,(function(e){e.addEventListener("click",t._onBankClick.bind(t))}))}},{key:"_onBankClick",value:function(t){var e=this.el.querySelector("."+this.options.itemActiveClass);t.stopPropagation(),this._paymentInputPaymentInput.checked=!0,e&&e.classList.remove(this.options.itemActiveClass),t.target.parentElement.classList.add(this.options.itemActiveClass)}}])&&l(n.prototype,i),a&&l(n,a),e}(i.a);function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function k(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}f={bankInputName:"tpayBank",bankLabelSelector:".tpay--list-item-container",formSelector:"#changePaymentForm",paymentMethodInputName:"paymentMethodId",itemActiveClass:"is--active",paymentId:"",changeTriggerSelector:".tpay--bank-input"},(p="options")in(d=y)?Object.defineProperty(d,p,{value:f,enumerable:!0,configurable:!0,writable:!0}):d[p]=f;var S=[new RegExp("^[0-9]$"),new RegExp("^[0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9]$"),new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9][0-9]$")],w=function(t){function e(){return m(this,e),k(this,g(e).apply(this,arguments))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this.validateBlik(),this._registerEvents()}},{key:"_registerEvents",value:function(){this.el.addEventListener("keyup",this.validateBlik.bind(this)),this.el.addEventListener("paste",this.validateBlik.bind(this))}},{key:"validateBlik",value:function(){var t,e,n,i=" "===this.el.value[3],o=this.el.value.length;if(o<0&&(this.el.value=""),o<=7&&o>0){if(o>=4&&!i)return this.el.value=(t=this.el.value,e=" ",n=3,"".concat(t.slice(0,n)).concat(e).concat(t.slice(n))),void this.validateBlik();for(;o>0&&!S[o-1].test(this.el.value);)this.el.value=this.el.value.slice(0,-1),o=this.el.value.length}else o>=8&&o<=9&&(this.el.value=this.el.value.slice(0,-1));this.el.value.length>=8&&(this.el.value=this.el.value.slice(0,7-this.el.value.length))}}])&&v(n.prototype,i),o&&v(n,o),e}(i.a),C=n("Cxgn"),O=n("p4AR");function P(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var I=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._httpClient=new O.a}var e,n,i;return e=t,(n=[{key:"sendBlikTransaction",value:function(t,e){this._httpClient.post(window.router["store-api.tpay.blik-payment.register-transaction"],t,e)}},{key:"sendBlikTransactionAgain",value:function(t,e){this._httpClient.post(window.router["store-api.tpay.blik-payment.register-transaction-again"],t,e)}},{key:"checkPaymentState",value:function(t,e){this._httpClient.post(window.router["store-api.tpay.blik-payment.check-payment-state"],JSON.stringify({orderId:t}),e)}}])&&P(e.prototype,n),i&&P(e,i),t}();function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function j(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function B(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function L(t,e){return(L=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var M=function(t){function e(){return E(this,e),B(this,$(e).apply(this,arguments))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(e,t),n=e,(i=[{key:"_open",value:function(t){this.getModal(),this._$modal.on("hidden.bs.modal",this._modalWrapper.remove),this._$modal.on("shown.bs.modal",t),this._$modal.modal({backdrop:"static",keyboard:!1}),this._$modal.modal("show")}}])&&j(n.prototype,i),o&&j(n,o),e}(n("2Jwc").a);function q(t){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function R(t,e){return!e||"object"!==q(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var J=new RegExp("^[0-9][0-9][0-9]+\\s[0-9][0-9][0-9]$"),N=function(t){function e(){return x(this,e),R(this,F(e).apply(this,arguments))}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this.$blikButtonSubmit=this.el.querySelector(this.options.submitButtonSelector),this.$allRequiredTosPositions=document.querySelectorAll(this.options.tos.tosContainerSelector+' [required="required"]'),this.$blikCodeInput=this.el.querySelector(this.options.blikCodeInputSelector),this.$blikModal=document.querySelector(".blik--modal"),this.$isOrderCreated=!1,this._errors=[],this._blikApiClient=new I,this._registerEvents()}},{key:"_registerEvents",value:function(){var t=this;this.el.addEventListener("submit",this._onSubmitForm.bind(this)),this.$blikButtonSubmit.addEventListener("click",this._sendBlik.bind(this)),o.a.iterate(this.$allRequiredTosPositions,(function(e){e.addEventListener("change",(function(){e.checked?e.classList.remove(t.options.isInvalidClass):e.classList.add(t.options.isInvalidClass)})),e.addEventListener("invalid",(function(t){t.target.scrollIntoView({behavior:"smooth",block:"center"})}))}))}},{key:"_onSubmitForm",value:function(t){t.preventDefault()}},{key:"_sendBlik",value:function(){if(this._tosValidation()){var t=new M(this.$blikModal.outerHTML);t.open(this._onOpenBlik.bind(this)),this.$blikModal=t.getModal(),this._blikCodeValidation()?!1===this.options.changedPayment?this._blikApiClient.sendBlikTransaction(new FormData(this.el),this._handleBlikTransaction.bind(this)):this._blikApiClient.sendBlikTransactionAgain(new FormData(this.el),this._handleBlikTransaction.bind(this)):(this.$blikCodeInput.classList.add(this.options.isInvalidClass),this.$blikModal.querySelector(".blik--modal").classList.add(this.options.isInvalidClass)),this.$blikModal.classList.add(this.options.pseudoModalAdditionalClass),this.$blikModal.querySelector(".modal-dialog").classList.add("modal-dialog-centered"),this.$isOrderCreated||this.$blikModal.querySelector(this.options.modalChangeMethodButtonSelector).addEventListener("click",(function(){t.close()}))}}},{key:"_onOpenBlik",value:function(){this._registerModalEvents(this.$blikModal),C.a.initializePlugins()}},{key:"_registerModalEvents",value:function(t){var e=this,n=t.querySelector(this.options.blikCodeInputSelector);t.querySelector(this.options.submitButtonSelector).addEventListener("click",(function(){var i=t.querySelector(e.options.modalInvalidCodeSelector);if(e._blikCodeValidation(n)){n.classList.remove(e.options.isInvalidClass),e.$blikModal.querySelector(".blik--modal").classList.remove(e.options.isInvalidClass);var o=new FormData(e.el);o.set("blikCode",n.value),e._notPaidOrderId?(o.append("orderId",e._notPaidOrderId),o.append("paymentMethodId",e.options.paymentMethodId),e._blikApiClient.sendBlikTransactionAgain(o,e._handleBlikTransaction.bind(e))):e._blikApiClient.sendBlikTransaction(o,e._handleBlikTransaction.bind(e))}else n.classList.add(e.options.isInvalidClass),i.classList.add(e.options.isInvalidClass)}))}},{key:"_handleBlikTransaction",value:function(t){var e=this,n=JSON.parse(t);if(n.orderId&&(this.$isOrderCreated=!0,this.$blikModal.querySelector(this.options.modalChangeMethodButtonSelector).addEventListener("click",(function(){window.location.replace("/account/order/edit/".concat(n.orderId))}))),!this._handleErrors(n))return!1;n.success&&n.orderId&&(this._finishUrl=n.finishUrl,this._orderId=n.orderId,setTimeout((function(){e._blikApiClient.checkPaymentState(n.orderId,e._handleCheckPaymentState.bind(e))}),500))}},{key:"_handleCheckPaymentState",value:function(t){var e=this,n=JSON.parse(t);if(!this._handleErrors(n))return!1;n.waiting?setTimeout((function(){e._blikApiClient.checkPaymentState(e._orderId,e._handleCheckPaymentState.bind(e))}),500):n.success&&(this.$blikModal.classList.add("is--success"),this.$blikModal.querySelector(".blik--modal-message-success").classList.remove("is--hidden"),this.$blikModal.querySelector(".blik--modal-message-wait").classList.add("is--hidden"),setTimeout((function(){window.location.replace(e._finishUrl)}),5e3))}},{key:"_handleErrors",value:function(t){return!(!t.waiting&&(void 0!==t.error&&t.error.length>0?(this._errors+=t.error,1):!t.success&&!t.blikCodeValid&&(this._notPaidOrderId=t.orderId,this.$blikModal.querySelector(".blik--modal").classList.add(this.options.isInvalidClass,"is-blik-invalid"),1)))}},{key:"_tosValidation",value:function(){var t=this;if(0===this.$allRequiredTosPositions.length)return!0;o.a.iterate(this.$allRequiredTosPositions,(function(e){e.checked?e.classList.remove(t.options.isInvalidClass):e.classList.add(t.options.isInvalidClass)}));var e=[];return[].forEach.call(this.$allRequiredTosPositions,(function(n){n.classList.contains(t.options.isInvalidClass)&&e.push(!0)})),0===e.length}},{key:"_blikCodeValidation",value:function(t){return void 0===t&&(t=this.$blikCodeInput),0===t.value.length?(t.classList.add(this.options.isInvalidClass),!1):J.test(t.value)}}])&&A(n.prototype,i),r&&A(n,r),e}(i.a);function V(t){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function H(t,e){return!e||"object"!==V(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function z(t){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(N,"options",{paymentMethodId:"",changedPayment:!1,blikTransactionUrl:"",blikCheckStatusUrl:"",submitButtonSelector:"#confirmFormSubmit",blikCodeInputSelector:".blik--input",pseudoModalAdditionalClass:"blik-modal",modalChangeMethodButtonSelector:".blik--modal-change-method-btn",modalInvalidCodeSelector:".blik--modal-invalid-code",modalWaitCodeSelector:".blik--modal-wait-state",modalErrorSelector:".blik--modal-error-state",modalSuccessSelector:".blik--modal-success-state",isInvalidClass:"is-invalid",tos:{tosContainerSelector:".confirm-tos"}});var K=function(t){function e(){return W(this,e),H(this,z(e).apply(this,arguments))}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(e,t),n=e,(i=[{key:"init",value:function(){this._errors=[],this._client=new O.a,this.checksCount=0,this.totalChecksCount=Math.floor(6e4*this.options.waitingTime/1e4),this._checkOrderPayment(),this._checkPaymentStateInterval(),this._hideChangePaymentFormButton()}},{key:"_checkPaymentStateInterval",value:function(){this.loopInterval=setInterval(this._loop.bind(this),1e4)}},{key:"_loop",value:function(){this._checkOrderPayment(),this.checksCount===this.totalChecksCount&&(clearInterval(this.loopInterval),this._changeButtonText(this.options.waitingFailText),this._changeLocation(this.options.failUrl))}},{key:"_checkOrderPayment",value:function(){this.checksCount++,this._client.post(this.options.checkUrl,JSON.stringify({transactionId:this.options.transactionId}),this._showPaymentState.bind(this))}},{key:"_showPaymentState",value:function(t){var e=JSON.parse(t);e.success?(this._changeButtonText(this.options.waitingSuccessText),this._changeLocation(this.options.successUrl)):e.waiting||(this._changeButtonText(this.options.waitingFailText),this._changeLocation(this.options.failUrl))}},{key:"_changeButtonText",value:function(t){console.log(t),this.el.querySelector("[data-info-text]").innerText=t}},{key:"_changeLocation",value:function(t){setTimeout((function(){window.location.href=t}),1500)}},{key:"_hideChangePaymentFormButton",value:function(){var t=this._getWaitingTimeFromPluginConfig(),e=Math.floor(60*t/2*1e3),n=this.el.querySelector(".change-payment-method-btn");setTimeout((function(){n.style.display="block"}),e)}},{key:"_getWaitingTimeFromPluginConfig",value:function(){var t=this.el.dataset.tpayPaymentCheckOptions;return JSON.parse(t).waitingTime}}])&&D(n.prototype,i),o&&D(n,o),e}(i.a);!function(t,e,n){e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}(K,"options",{transactionId:"",successUrl:"",failUrl:"",checkUrl:"",waitingTime:2,waitingSuccessText:"",waitingFailText:""});var Q=window.PluginManager;Q.register("TpayPaymentBankSelection",y,"[data-tpay-bank-selection]"),Q.register("TpayBlikMask",w,".blik--input"),Q.register("TpayBlik",N,"[data-tpay-blik"),Q.register("TpayPaymentCheck",K,"[data-tpay-payment-check]")}},[["W1qi","runtime","vendor-node","vendor-shared"]]]);